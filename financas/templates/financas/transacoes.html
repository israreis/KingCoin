{% extends 'base.html' %}
{% load static %}

{% block title %}Minhas Transações{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/transactions.css' %}">
{% endblock %}

{% block navbar %}{% endblock %}
{% block footer %}{% endblock %}

{% block content %}

<section class="theme-dark">

    <!-- Botão Menu Hamburger para Mobile -->
    <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Abrir menu">
        <i class="fa-solid fa-bars"></i>
    </button>

    <div class="app">

        <!-- MAIN -->
        <main class="py-10 main">
            <!-- Cabeçalho / título -->
            <div class="flex flex-col md:flex-row md:items-end md:justify-between">
                <div>
                    <h1 class="page-title">Transações</h1>
                </div>
            </div>

            <!-- CARDS SUPERIORES - SCROLL HORIZONTAL EM MOBILE -->
            <div class="top-cards" role="list" aria-label="Destaques financeiros">
                <!-- Card 1 -->
                <article class="card g-blue">
                    <div class="flex items-start justify-between">
                        <div>
                            <div class="text-sm text-gray-300">Maior despesa <span
                                    class="ml-2 text-xs text-gray-400">Este mês ▾</span></div>
                            <h3 style="color:#e9f0ec"> <i class="fa-solid fa-circle-plus"
                                    style="color:#4cc0ff;margin-right:8px"></i> Saúde</h3>
                            <div style="margin-top:6px; font-size:13px; color:#ff6b6b"><i
                                    class="fa-solid fa-arrow-trend-down" style="margin-right:8px"></i>14% <span
                                    style="color:#aab3b1; margin-left:6px; font-size:12px">este mês</span></div>
                        </div>
                    </div>
                </article>

                <!-- Card 2 -->
                <article class="card g-purple">
                    <div class="flex items-start justify-between">
                        <div>
                            <div class="text-sm text-gray-300">Menor despesa <span
                                    class="ml-2 text-xs text-gray-400">Este mês ▾</span></div>
                            <h3 style="color:#f2e8ff"> <i class="fa-solid fa-face-laugh-beam"
                                    style="color:#f08fe3;margin-right:8px"></i> Diversão</h3>
                            <div style="margin-top:6px; font-size:13px; color:#6ee7b7"><i
                                    class="fa-solid fa-arrow-trend-up" style="margin-right:8px"></i>14% <span
                                    style="color:#aab3b1; margin-left:6px; font-size:12px">este mês</span></div>
                        </div>
                    </div>
                </article>

                <!-- Card 3 -->
                <article class="card g-green">
                    <div class="flex items-start justify-between">
                        <div>
                            <div class="text-sm text-gray-300">Maior entrada <span
                                    class="ml-2 text-xs text-gray-400">Este mês ▾</span></div>
                            <h3 style="color:#e8fff2"> <i class="fa-solid fa-dollar-sign"
                                    style="color:#23b785;margin-right:8px"></i> Freelancer</h3>
                            <div style="margin-top:6px; font-size:13px; color:#6ee7b7"><i
                                    class="fa-solid fa-arrow-trend-up" style="margin-right:8px"></i>14% <span
                                    style="color:#aab3b1; margin-left:6px; font-size:12px">este mês</span></div>
                        </div>
                    </div>
                </article>

                <!-- Card 4 -->
                <article class="card g-navy">
                    <div class="flex items-start justify-between">
                        <div>
                            <div class="text-sm text-gray-300">Maior invest. <span
                                    class="ml-2 text-xs text-gray-400">Este mês ▾</span></div>
                            <h3 style="color:#f5f8fb"> <i class="fa-solid fa-coins"
                                    style="color:#9fbefc;margin-right:8px"></i> CDB 105%</h3>
                            <div style="margin-top:6px; font-size:13px; color:#6ee7b7"><i
                                    class="fa-solid fa-arrow-trend-up" style="margin-right:8px"></i>14% <span
                                    style="color:#aab3b1; margin-left:6px; font-size:12px">este mês</span></div>
                        </div>
                    </div>
                </article>
            </div>

            <!-- Painel de histórico de transações - EMPILHADO VERTICALMENTE EM MOBILE -->
            <section class="panel">
                <div class="p-10">
                    <div class="section-title">Hoje</div>

                    <!-- Transação 1 -->
                    <div class="tx-row">
                        <div class="left">
                            <div class="icon" style="background:#1f6fe0">
                                <i class="fa-solid fa-hospital-user"></i>
                            </div>
                            <div class="tx-info">
                                <div style="font-weight:600">Saúde - Remédios na farmácia</div>
                                <div style="font-size:13px; color:rgba(255,255,255,0.6); margin-top:4px">Categoria •
                                    Subcategoria</div>
                            </div>
                        </div>
                        <div class="tx-amount minus">- R$97,00</div>
                    </div>

                    <!-- Transação 2 -->
                    <div class="tx-row">
                        <div class="left">
                            <div class="icon" style="background:#f08fe3">
                                <i class="fa-solid fa-face-laugh-beam"></i>
                            </div>
                            <div class="tx-info">
                                <div style="font-weight:600">Diversão - Rolê com os amigos</div>
                                <div style="font-size:13px; color:rgba(255,255,255,0.6); margin-top:4px">Categoria •
                                    Subcategoria</div>
                            </div>
                        </div>
                        <div class="tx-amount minus">- R$148,90</div>
                    </div>

                    <!-- LINHA DIVISÓRIA ÚNICA - SEPARA HOJE DE ONTEM -->
                    <div class="thin-hr"></div>

                    <div class="section-title">Ontem</div>

                    <!-- Transação 3 -->
                    <div class="tx-row">
                        <div class="left">
                            <div class="icon" style="background:#b53b3b">
                                <i class="fa-solid fa-file-invoice-dollar"></i>
                            </div>
                            <div class="tx-info">
                                <div style="font-weight:600">Contas - Conta de Luz e Água</div>
                                <div style="font-size:13px; color:rgba(255,255,255,0.6); margin-top:4px">Fixo • Mensal
                                </div>
                            </div>
                        </div>
                        <div class="tx-amount minus">- R$427,90</div>
                    </div>

                    <!-- Transação 4 -->
                    <div class="tx-row">
                        <div class="left">
                            <div class="icon" style="background:#1f6fe0">
                                <i class="fa-solid fa-dollar-sign"></i>
                            </div>
                            <div class="tx-info">
                                <div style="font-weight:600">Salário</div>
                                <div style="font-size:13px; color:rgba(255,255,255,0.6); margin-top:4px">Recebimento •
                                    Emprego</div>
                            </div>
                        </div>
                        <div class="tx-amount plus">+ R$5.456,37</div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- SCRIPTS -->
    <script>
        // Inicializa tema conforme preferencia do usuário (localStorage)
        (function () {
            const body = document.body;
            const stored = localStorage.getItem('kc-theme');
            if (stored === 'light') {
                body.classList.remove('theme-dark'); body.classList.add('theme-light');
            } else {
                body.classList.remove('theme-light'); body.classList.add('theme-dark');
            }
            applyBg();
        })();

        function applyBg() {
            const body = document.body;
            if (body.classList.contains('theme-dark')) {
                body.style.background = '#000805';
            } else {
                body.style.background = '#fffcf0';
            }
        }

        // Toggle de tema
        document.getElementById('themeToggle').addEventListener('click', function () {
            const body = document.body;
            if (body.classList.contains('theme-dark')) {
                body.classList.remove('theme-dark'); body.classList.add('theme-light');
                localStorage.setItem('kc-theme', 'light');
            } else {
                body.classList.remove('theme-light'); body.classList.add('theme-dark');
                localStorage.setItem('kc-theme', 'dark');
            }
            applyBg();
        });

        // Menu Hamburger para Mobile
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const sidenav = document.getElementById('sidenav');

        mobileMenuBtn.addEventListener('click', function () {
            sidenav.classList.toggle('mobile-open');
            const icon = this.querySelector('i');
            if (sidenav.classList.contains('mobile-open')) {
                icon.classList.remove('fa-bars');
                icon.classList.add('fa-times');
            } else {
                icon.classList.remove('fa-times');
                icon.classList.add('fa-bars');
            }
        });

        // Fechar menu ao clicar fora
        document.addEventListener('click', function (event) {
            if (!sidenav.contains(event.target) && !mobileMenuBtn.contains(event.target)) {
                sidenav.classList.remove('mobile-open');
                const icon = mobileMenuBtn.querySelector('i');
                icon.classList.remove('fa-times');
                icon.classList.add('fa-bars');
            }
        });

        // Touch / mouse scroll suave para top-cards
        const scroller = document.querySelector('.top-cards');
        let isDown = false, startX, scrollLeft;
        if (scroller) {
            scroller.addEventListener('mousedown', (e) => { isDown = true; scroller.classList.add('active'); startX = e.pageX - scroller.offsetLeft; scrollLeft = scroller.scrollLeft; });
            scroller.addEventListener('mouseleave', () => { isDown = false; scroller.classList.remove('active'); });
            scroller.addEventListener('mouseup', () => { isDown = false; scroller.classList.remove('active'); });
            scroller.addEventListener('mousemove', (e) => {
                if (!isDown) return;
                e.preventDefault();
                const x = e.pageX - scroller.offsetLeft;
                const walk = (x - startX) * 1.2;
                scroller.scrollLeft = scrollLeft - walk;
            });

            // Touch events para mobile
            scroller.addEventListener('touchstart', (e) => {
                isDown = true;
                startX = e.touches[0].pageX - scroller.offsetLeft;
                scrollLeft = scroller.scrollLeft;
            });
            scroller.addEventListener('touchend', () => { isDown = false; });
            scroller.addEventListener('touchmove', (e) => {
                if (!isDown) return;
                e.preventDefault();
                const x = e.touches[0].pageX - scroller.offsetLeft;
                const walk = (x - startX) * 1.2;
                scroller.scrollLeft = scrollLeft - walk;
            });
        }
    </script>

</section>
{% endblock %}
