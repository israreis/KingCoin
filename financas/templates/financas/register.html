{% extends "base.html" %}
{% load static %}

{% block navbar %}{% endblock %}
{% block footer %}{% endblock %}

{% block title %}Kingcoin - Cadastre-se{% endblock %}

{% block body %}

<body class="transition-colors duration-500 bg-[#000805] text-white flex items-center justify-center min-h-screen font-[Archivo] relative overflow-hidden" id="body">

  <!-- Background da página -->
  <div id="bg-image" class="absolute inset-0 bg-cover bg-center bg-no-repeat opacity-80 -z-10" style="background-image: url('{% static 'img/background-escuro.png' %}')"></div>

  <!-- Botão de alternar tema (claro/escuro) -->
  <!-- <div class="absolute top-6 right-8 flex items-center gap-2 z-20">
    <label class="relative inline-flex items-center cursor-pointer">
      <input type="checkbox" id="theme-toggle" class="sr-only peer">
      <div class="w-12 h-6 bg-gray-400 rounded-full peer peer-checked:after:translate-x-6 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-[#23b785] after:h-5 after:w-5 after:rounded-full after:transition-all peer-checked:bg-[#23b785]/30"></div>
    </label>
  </div> -->

  <div class="absolute top-6 right-8 flex items-center gap-2 z-20">
    <button class="theme-toggle bg-transparent border-none cursor-pointer text-xl text-white" id="theme-toggle">
      <i class="fas fa-sun text-[#fffcf0]"></i>
    </button>
  </div>

  <!-- Logo do site -->
  <div class="absolute top-8 left-10 z-20 flex items-center">
    <a href="{% url 'landing' %}" class="block"> 
      <img id="logo-img" src="{% static 'img/KingCoinLogo.svg' %}" alt="Kingcoin" class="w-64 h-auto max-w-[160px] transition-all duration-500">
    </a>
  </div>

  <!-- Card de cadastro -->
  <div class="flex flex-col items-center justify-center w-full px-6 relative z-10">
    <div id="register-card" class="glass-dark w-full max-w-lg text-center shadow-xl animate-zoomIn">
      <!-- Título -->
      <h2 class="text-4xl font-semibold mb-3 text-left">Cadastre-se</h2>

      <!-- Descrição -->
      <p id="description-text" class="text-left text-gray-300 mb-8">
        Vamos organizar tudo. Faça <a href="{% url 'login' %}" class="text-[#23b785] font-medium">Login</a> 
        ou <a href="{% url 'register' %}" class="text-[#23b785] font-medium">Cadastre-se</a> agora mesmo!
      </p>

      <!-- Formulário de cadastro -->
      <form method="POST" class="grid grid-cols-1 md:grid-cols-2 gap-6 text-left">
        {% csrf_token %}

        <!-- Nome -->
        <div>
          <label for="{{ form.first_name.id_for_label }}" class="block text-sm mb-1">{{ form.first_name.label }}</label>
          {{ form.first_name }}
          {% if form.first_name.errors %}
            <div class="text-red-400 text-xs mt-1">{{ form.first_name.errors.0 }}</div>
          {% endif %}
        </div>

        <!-- Sobrenome -->
        <div>
          <label for="{{ form.last_name.id_for_label }}" class="block text-sm mb-1">{{ form.last_name.label }}</label>
          {{ form.last_name }}
          {% if form.last_name.errors %}
            <div class="text-red-400 text-xs mt-1">{{ form.last_name.errors.0 }}</div>
          {% endif %}
        </div>

        <!-- E-mail -->
        <div class="md:col-span-2">
          <label for="{{ form.email.id_for_label }}" class="block text-sm mb-1">{{ form.email.label }}</label>
          {{ form.email }}
          {% if form.email.errors %}
            <div class="text-red-400 text-xs mt-1">{{ form.email.errors.0 }}</div>
          {% endif %}
        </div>

        <!-- Telefone -->
        <div class="md:col-span-2">
          <label for="{{ form.phone.id_for_label }}" class="block text-sm mb-1">{{ form.phone.label }}</label>
          {{ form.phone }}
          {% if form.phone.errors %}
            <div class="text-red-400 text-xs mt-1">{{ form.phone.errors.0 }}</div>
          {% endif %}
        </div>

        <!-- Senha -->
        <div>
          <label for="{{ form.password1.id_for_label }}" class="block text-sm mb-1">{{ form.password1.label }}</label>
          {{ form.password1 }}
          {% if form.password1.errors %}
            <div class="text-red-400 text-xs mt-1">{{ form.password1.errors.0 }}</div>
          {% endif %}
        </div>

        <!-- Confirmar senha -->
        <div>
          <label for="{{ form.password2.id_for_label }}" class="block text-sm mb-1">{{ form.password2.label }}</label>
          {{ form.password2 }}
          {% if form.password2.errors %}
            <div class="text-red-400 text-xs mt-1">{{ form.password2.errors.0 }}</div>
          {% endif %}
        </div>

        <!-- Botão e link para login -->
        <div class="md:col-span-2 flex flex-col items-center">
          <button type="submit" class="bg-[#23b785] text-[#000805] font-semibold py-3 rounded-full w-full hover:opacity-90 transition">Cadastrar-se</button>
          <p id="bottom-text" class="text-sm text-gray-300 text-center mt-3">
            Já tem uma conta? <a href="{% url 'login' %}" class="text-[#23b785] font-medium">Entrar</a>
          </p>
        </div>
      </form>

      <!-- Exibir erros não relacionados a campos específicos -->
      {% if form.non_field_errors %}
        <div class="mt-4 p-3 bg-red-500/20 border border-red-500 rounded-lg">
          {% for error in form.non_field_errors %}
            <p class="text-red-400 text-sm">{{ error }}</p>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Script para alternar tema -->
  <!-- <script>
    const toggle = document.getElementById('theme-toggle');
    const body = document.getElementById('body');
    const card = document.getElementById('register-card');
    const descText = document.getElementById('description-text');
    const bottomText = document.getElementById('bottom-text');
    const bgImage = document.getElementById('bg-image');
    const logoImg = document.getElementById('logo-img');
     const themeIcon = toggle.querySelector('i');
    
    const BG_DARK = "url('{% static 'img/background-escuro.png' %}')";
    const BG_LIGHT = "url('{% static 'img/background-claro.png' %}')";
    const LOGO_DARK = "{% static 'img/KingCoinLogo.svg' %}";
    const LOGO_LIGHT = "{% static 'img/KingCoin-Logo-Light.svg' %}";

    // Função para aplicar o tema
    function applyTheme(isLight) {
      if (isLight) {
        // Tema claro
        body.classList.remove('bg-[#000805]', 'text-white');
        body.classList.add('bg-[#fffcf0]', 'text-[#000805]');
        card.classList.remove('glass-dark');
        card.classList.add('glass-light');
        descText.classList.replace('text-gray-300', 'text-[#4b4b4b]');
        bottomText.classList.replace('text-gray-300', 'text-[#4b4b4b]');
        bgImage.style.backgroundImage = BG_LIGHT;
        logoImg.src = LOGO_LIGHT;
        // toggle.checked = true;

   // Atualizar ícone para lua
        themeIcon.classList.remove('fa-sun', 'text-[#fffcf0]');
        themeIcon.classList.add('fa-moon', 'text-[#000805]');


        localStorage.setItem('theme', 'light');
      } else {
        // Tema escuro
        body.classList.remove('bg-[#fffcf0]', 'text-[#000805]');
        body.classList.add('bg-[#000805]', 'text-white');
        card.classList.remove('glass-light');
        card.classList.add('glass-dark');
        descText.classList.replace('text-[#4b4b4b]', 'text-gray-300');
        bottomText.classList.replace('text-[#4b4b4b]', 'text-gray-300');
        bgImage.style.backgroundImage = BG_DARK;
        logoImg.src = LOGO_DARK;
        // toggle.checked = false;
        // Atualizar ícone para sol
         themeIcon.classList.remove('fa-moon', 'text-[#000805]');
      themeIcon.classList.add('fa-sun', 'text-[#fffcf0]');

        localStorage.setItem('theme', 'dark');
      }
    }

    // Aplicar tema salvo no carregamento
    document.addEventListener('DOMContentLoaded', () => {
      const savedTheme = localStorage.getItem('theme') || 'dark';
      applyTheme(savedTheme === 'light');
      body.classList.remove('transition-colors', 'duration-500');
      setTimeout(() => body.classList.add('transition-colors', 'duration-500'), 100);
    });

    // Alternar tema ao clicar
    // toggle.addEventListener('change', () => applyTheme(toggle.checked));
        toggle.addEventListener('click', () => {
      const isLight = body.classList.contains('bg-[#fffcf0]');
      applyTheme(!isLight);
        });
  </script> -->

  <script>
  const toggle = document.getElementById('theme-toggle');
  const body = document.getElementById('body');
  const card = document.getElementById('register-card');
  const descText = document.getElementById('description-text');
  const bottomText = document.getElementById('bottom-text');
  const bgImage = document.getElementById('bg-image');
  const logoImg = document.getElementById('logo-img');
  const themeIcon = toggle ? toggle.querySelector('i') : null;

  const BG_DARK = "url('{% static 'img/background-escuro.png' %}')";
  const BG_LIGHT = "url('{% static 'img/background-claro.png' %}')";
  const LOGO_DARK = "{% static 'img/KingCoinLogo.svg' %}";
  const LOGO_LIGHT = "{% static 'img/KingCoin-Logo-Light.svg' %}";

  // Helpers para o ícone
  function setIconToSun() {
    if (!themeIcon) return;
    themeIcon.classList.remove('fa-moon');
    themeIcon.classList.remove('text-[#000805]');
    themeIcon.classList.add('fa-sun');
    themeIcon.classList.add('text-[#fffcf0]');
  }

  function setIconToMoon() {
    if (!themeIcon) return;
    themeIcon.classList.remove('fa-sun');
    themeIcon.classList.remove('text-[#fffcf0]');
    themeIcon.classList.add('fa-moon');
    themeIcon.classList.add('text-[#000805]');
  }

  // Aplica o tema (isLight = true => claro, false => escuro)
  function applyTheme(isLight) {
    if (!body) return;
    if (isLight) {
      // Tema claro
      body.classList.remove('bg-[#000805]', 'text-white');
      body.classList.add('bg-[#fffcf0]', 'text-[#000805]');
      if (card) { card.classList.remove('glass-dark'); card.classList.add('glass-light'); }
      if (descText) { descText.classList.remove('text-gray-300'); descText.classList.add('text-[#4b4b4b]'); }
      if (bottomText) { bottomText.classList.remove('text-gray-300'); bottomText.classList.add('text-[#4b4b4b]'); }
      if (bgImage) bgImage.style.backgroundImage = BG_LIGHT;
      if (logoImg) logoImg.src = LOGO_LIGHT;
      setIconToMoon();
      localStorage.setItem('theme', 'light');
      body.setAttribute('data-theme', 'light');
      console.log('[theme] aplicado: claro');
    } else {
      // Tema escuro
      body.classList.remove('bg-[#fffcf0]', 'text-[#000805]');
      body.classList.add('bg-[#000805]', 'text-white');
      if (card) { card.classList.remove('glass-light'); card.classList.add('glass-dark'); }
      if (descText) { descText.classList.remove('text-[#4b4b4b]'); descText.classList.add('text-gray-300'); }
      if (bottomText) { bottomText.classList.remove('text-[#4b4b4b]'); bottomText.classList.add('text-gray-300'); }
      if (bgImage) bgImage.style.backgroundImage = BG_DARK;
      if (logoImg) logoImg.src = LOGO_DARK;
      setIconToSun();
      localStorage.setItem('theme', 'dark');
      body.setAttribute('data-theme', 'dark');
      console.log('[theme] aplicado: escuro');
    }
  }

  // Inicialização: força tema escuro ao carregar
  document.addEventListener('DOMContentLoaded', () => {
    try {
      // Forçar escuro por padrão nesta página de cadastro
      applyTheme(false);
      localStorage.setItem('theme', 'dark');

      // Evita flicker de transição na carga inicial
      body.classList.remove('transition-colors', 'duration-500');
      setTimeout(() => body.classList.add('transition-colors', 'duration-500'), 120);

      console.log('[theme] inicialização completa (forçado escuro)');
    } catch (err) {
      console.error('[theme] erro na inicialização:', err);
      // fallback
      applyTheme(false);
    }
  });

  // Alternar tema ao clicar no botão (mantém persistência)
  if (toggle) {
    toggle.addEventListener('click', () => {
      const isLightNow = body.getAttribute('data-theme') === 'light';
      applyTheme(!isLightNow);
    });
  } else {
    console.warn('[theme] botão de alternância (#theme-toggle) não encontrado.');
  }
</script>

</body>
{% endblock %}